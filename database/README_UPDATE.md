# تحديث قاعدة البيانات لتتبع المبيعات
## Database Update for Sales Tracking

## المشكلة التي تم حلها
كانت المشكلة أن إحصائيات المبيعات لا تتحدث عند تسليم الطلبات ودفع المال. الآن تم حل هذه المشكلة من خلال:

### 1. تحديث نظام الطلبات
- عند تغيير حالة الطلب إلى "تم التسليم" (`delivered`)
- يتم تلقائياً تحديث حالة الدفع إلى "مدفوع" (`paid`)
- يتم تسجيل تاريخ التسليم
- يتم تحديث إحصائيات المبيعات

### 2. إضافة أعمدة جديدة
- `sales_count` في جدول `products` لتتبع عدد المبيعات
- `delivered_at` في جدول `orders` لتسجيل تاريخ التسليم

### 3. تحسين الإحصائيات
- إحصائيات المبيعات تعتمد فقط على الطلبات المدفوعة
- عرض المبيعات اليومية في لوحة التحكم
- تحديث عدد المبيعات للمنتجات تلقائياً

## كيفية تطبيق التحديث

### الطريقة الأولى - عبر المتصفح:
1. اذهب إلى: `http://localhost/proj/database/update_database.php`
2. ستظهر رسائل التحديث
3. تأكد من عدم وجود أخطاء

### الطريقة الثانية - عبر phpMyAdmin:
1. اذهب إلى phpMyAdmin
2. اختر قاعدة البيانات `arabic_store`
3. اذهب إلى تبويب "SQL"
4. انسخ محتوى ملف `update_sales_tracking.sql`
5. اضغط "تنفيذ"

### الطريقة الثالثة - عبر سطر الأوامر:
```bash
cd /path/to/your/project/database
php update_database.php
```

## التحقق من نجاح التحديث

### 1. تحقق من الأعمدة الجديدة:
```sql
DESCRIBE products;
DESCRIBE orders;
```
يجب أن ترى:
- `sales_count` في جدول `products`
- `delivered_at` في جدول `orders`

### 2. اختبر تحديث حالة الطلب:
1. اذهب إلى لوحة تحكم المشرف
2. غير حالة طلب إلى "تم التسليم"
3. تحقق من تحديث الإحصائيات

### 3. تحقق من الإحصائيات:
- اذهب إلى لوحة التحكم الرئيسية
- يجب أن ترى إحصائيات المبيعات محدثة
- يجب أن ترى جدول المبيعات اليومية

## الميزات الجديدة

### 1. تحديث تلقائي للإحصائيات
- عند تسليم الطلب، تتحدث الإحصائيات تلقائياً
- لا حاجة لتدخل يدوي

### 2. تتبع المبيعات للمنتجات
- كل منتج يحتفظ بعدد مرات بيعه
- يمكن استخدام هذا لترتيب المنتجات الأكثر مبيعاً

### 3. إحصائيات مفصلة
- المبيعات اليومية
- متوسط قيمة الطلب
- معدل إتمام الطلبات

### 4. تحسين الأداء
- فهارس جديدة لتسريع الاستعلامات
- جدول إحصائيات يومية للتحسين المستقبلي

## استكشاف الأخطاء

### إذا لم تعمل الإحصائيات:
1. تأكد من تشغيل ملف التحديث
2. تحقق من وجود الأعمدة الجديدة
3. تأكد من أن حالة الدفع `paid` للطلبات المسلمة

### إذا ظهرت أخطاء SQL:
1. تحقق من إصدار MySQL (يجب أن يكون 5.7+)
2. تأكد من صلاحيات قاعدة البيانات
3. جرب تنفيذ الاستعلامات واحداً تلو الآخر

## ملاحظات مهمة

- ⚠️ **احتفظ بنسخة احتياطية** من قاعدة البيانات قبل التحديث
- ✅ التحديث آمن ولا يحذف أي بيانات موجودة
- 🔄 يمكن تشغيل التحديث عدة مرات بأمان
- 📊 الإحصائيات ستحسب البيانات الموجودة تلقائياً

## الدعم

إذا واجهت أي مشاكل:
1. تحقق من ملف الأخطاء في الخادم
2. تأكد من تشغيل Apache و MySQL
3. تحقق من صلاحيات الملفات
4. راجع رسائل الخطأ في المتصفح
